# 知识管理系统 - 开发文档

## 1. 开发阶段规划

### 第一阶段：MVP（最小可行产品）- 预计2-3周

**核心功能：**
-   基础的文章下载和Markdown转换
-   简单的文件分类保存（手动创建目录）
-   基础的Markdown阅读界面

**技术栈建议：**
-   **前端**：Vue 3 + Vite（轻量级、开发快）
-   **后端**：Node.js + Express
-   **存储**：本地文件系统 + SQLite（用于元数据）
-   **UI库**：Element Plus（快速开发）

**架构草图：**
```
src/
├── main.js                 # 应用入口
├── components/             # UI组件
│   ├── ArticleList.vue     # 文章列表
│   ├── ArticleReader.vue   # 阅读器
│   └── CategoryTree.vue    # 分类树
├── services/               # 核心服务层
│   ├── downloader.js       # 下载服务
│   ├── converter.js        # 转换服务
│   └── storage.js          # 存储服务
└── utils/                  # 工具函数
```

### 第二阶段：功能完善 - 预计3-4周

**新增功能：**
-   智能分类和标签系统
-   全文搜索功能
-   阅读进度管理
-   基础的知识关联（如"相关文章"推荐）

**技术增强：**
-   集成全文搜索引擎（如 Meilisearch，比Elasticsearch更轻量）
-   添加标签管理模块
-   实现阅读状态持久化

### 第三阶段：体验优化与扩展 - 预计2-3周

**优化内容：**
-   UI/UX 改进，增加主题切换等
-   性能优化（虚拟列表、懒加载）
-   增强错误处理和日志记录
-   数据导入/导出功能

## 2. 模块化架构设计

### 2.1. 核心模块划分

1.  **下载模块 (Downloader)**
    -   职责：网页内容提取、反爬虫处理、错误重试。
    -   接口：`download(url): Promise<string>`

2.  **转换模块 (Converter)**
    -   职责：HTML到Markdown转换、图片本地化、元数据提取。
    -   接口：`convertToMarkdown(html): Promise<{content: string, meta: object}>`

3.  **存储模块 (Storage)**
    -   职责：文件系统管理、数据库操作、分类和标签管理。
    -   接口：`saveArticle(article): Promise<void>`, `getArticles(filters): Promise<Article[]>`

4.  **阅读模块 (Reader)**
    -   职责：Markdown渲染、阅读进度跟踪、搜索和过滤。

### 2.2. 模块间通信
建议使用Pinia作为状态管理中心，处理跨模块的状态共享和通信，避免复杂的事件总线。

## 3. 技术选型建议

-   **前端框架**: Vue 3 + Composition API + Vite
-   **状态管理**: Pinia
-   **UI组件库**: Element Plus
-   **后端运行时**: Node.js + Express
-   **HTML解析**: Cheerio (服务端)
-   **HTML转Markdown**: Turndown
-   **动态页面处理**: Puppeteer (作为备用方案)
-   **数据库**: SQLite (通过 `sqlite3` 或 `better-sqlite3` 库)
-   **打包工具**: Electron (用于桌面端)

## 4. 开发优先级

1.  **高优先级 (必须实现)**
    -   文章下载与转换
    -   手动分类管理
    -   Markdown阅读器
    -   基于标题的简单搜索

2.  **中优先级 (重要功能)**
    -   自动分类建议
    -   标签系统
    -   阅读进度保存
    -   数据导出

3.  **低优先级 (锦上添花)**
    -   知识图谱
    -   云同步
    -   协作功能
    -   AI推荐

## 5. 技术难点和解决方案

1.  **内容提取准确性**
    -   **问题**：不同网站结构差异大。
    -   **解决**：建立可配置的网站适配器模式 (Adapter Pattern)，允许用户为不同网站配置CSS选择器。默认提供一个通用识别器。

2.  **性能优化**
    -   **问题**：大量文章（如 1000+）导致UI卡顿。
    -   **解决**：文章列表使用虚拟滚动 (Virtual Scrolling)。图片等资源使用懒加载。数据库查询建立索引。

3.  **数据一致性**
    -   **问题**：文件系统中的文件和数据库中的元数据可能不一致。
    -   **解决**：采用事务性操作。启动时进行一次快速校验，扫描文件并与数据库同步。

## 6. 开发工具与流程

-   **开发环境**: VS Code + Volar插件
-   **版本控制**: Git + Git Flow工作流
-   **代码质量**: ESLint + Prettier
-   **类型检查**: TypeScript
-   **测试**: Vitest (单元/组件测试) + Playwright (E2E测试)
-   **持续集成**: GitHub Actions (自动化测试与构建)
-   **项目管理**: GitHub Issues/Projects 